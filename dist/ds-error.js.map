{"version":3,"file":"ds-error.js","sources":["../src/ds-error.ts"],"sourcesContent":["import { get } from '@ember/object';\nimport validationError, {\n  type IValidationError,\n} from './utils/validation-error.ts';\n\ninterface IOptions {\n  path: string;\n  key: boolean;\n}\n\n/**\n *  @class DS Error\n *  @module Validators\n */\n\n/**\n * @method validate\n * @param {Any} value\n * @param {Object} options\n * @param {Object} model\n * @param {String} attribute\n */\nexport default function validateDsError(\n  value: unknown,\n  options: IOptions,\n  model: object,\n  attribute: string,\n): true | IValidationError<unknown, IOptions> {\n  const { path, key } = getPathAndKey(attribute);\n\n  const errors = get(model, path) as\n    | undefined\n    | {\n        has: (key: string) => unknown;\n        errorsFor: (\n          key: string,\n        ) => Array<{ attribute: string; message: string }>;\n      };\n\n  if (errors && errors.has && errors.has(key)) {\n    const errorsFor = errors.errorsFor(key);\n    return validationError(\n      'ds',\n      null,\n      options,\n      errorsFor.length ? errorsFor[errorsFor.length - 1]!.message : [],\n    );\n  }\n\n  return true;\n}\n\nexport function getPathAndKey(attribute: string): {\n  path: string;\n  key: string;\n} {\n  const path = attribute.split('.');\n  const key = path.pop()!;\n\n  path.push('errors');\n\n  return { path: path.join('.'), key };\n}\n"],"names":["validateDsError","value","options","model","attribute","path","key","getPathAndKey","errors","get","has","errorsFor","validationError","length","message","split","pop","push","join"],"mappings":";;;AAUA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASA,eAAeA,CACrCC,KAAc,EACdC,OAAiB,EACjBC,KAAa,EACbC,SAAiB,EAC2B;EAC5C,MAAM;IAAEC,IAAI;AAAEC,IAAAA;AAAI,GAAC,GAAGC,aAAa,CAACH,SAAS,CAAC;AAE9C,EAAA,MAAMI,MAAM,GAAGC,GAAG,CAACN,KAAK,EAAEE,IAAI,CAOzB;AAEL,EAAA,IAAIG,MAAM,IAAIA,MAAM,CAACE,GAAG,IAAIF,MAAM,CAACE,GAAG,CAACJ,GAAG,CAAC,EAAE;AAC3C,IAAA,MAAMK,SAAS,GAAGH,MAAM,CAACG,SAAS,CAACL,GAAG,CAAC;IACvC,OAAOM,eAAe,CACpB,IAAI,EACJ,IAAI,EACJV,OAAO,EACPS,SAAS,CAACE,MAAM,GAAGF,SAAS,CAACA,SAAS,CAACE,MAAM,GAAG,CAAC,CAAC,CAAEC,OAAO,GAAG,EAChE,CAAC;AACH;AAEA,EAAA,OAAO,IAAI;AACb;AAEO,SAASP,aAAaA,CAACH,SAAiB,EAG7C;AACA,EAAA,MAAMC,IAAI,GAAGD,SAAS,CAACW,KAAK,CAAC,GAAG,CAAC;AACjC,EAAA,MAAMT,GAAG,GAAGD,IAAI,CAACW,GAAG,EAAG;AAEvBX,EAAAA,IAAI,CAACY,IAAI,CAAC,QAAQ,CAAC;EAEnB,OAAO;AAAEZ,IAAAA,IAAI,EAAEA,IAAI,CAACa,IAAI,CAAC,GAAG,CAAC;AAAEZ,IAAAA;GAAK;AACtC;;;;"}